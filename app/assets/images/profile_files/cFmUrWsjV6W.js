/*!CK:3578570626!*//*1448301852,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["CVuXM"]); }

__d('PhotoAlbumAudienceInput',['Arbiter','CSS','DOM','Event'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m,n,o,p,q){'use strict';this.$PhotoAlbumAudienceInput1=m;if(n){this.$PhotoAlbumAudienceInput2=n;this.$PhotoAlbumAudienceInput3=o;this.$PhotoAlbumAudienceInput4=p;this.$PhotoAlbumAudienceInput5=q;h.subscribe('Tokenizer/init',this.$PhotoAlbumAudienceInput6.bind(this));k.listen(this.$PhotoAlbumAudienceInput4,'click',this.$PhotoAlbumAudienceInput7.bind(this));}}l.prototype.removeHiddenPrivacyWidget=function(){'use strict';[this.$PhotoAlbumAudienceInput1,this.$PhotoAlbumAudienceInput2,this.$PhotoAlbumAudienceInput5].forEach(function(m){if(m&&i.hasClass(m,'hidden_elem'))j.remove(m);});};l.prototype.$PhotoAlbumAudienceInput7=function(){'use strict';this.$PhotoAlbumAudienceInput8.removeAllTokens();this.$PhotoAlbumAudienceInput9(null,null);};l.prototype.$PhotoAlbumAudienceInput6=function(m,n){'use strict';if(this.$PhotoAlbumAudienceInput8||this.$PhotoAlbumAudienceInput3!=n.element)return;this.$PhotoAlbumAudienceInput8=n;this.$PhotoAlbumAudienceInput9(null,null);h.subscribe('Form/change',this.$PhotoAlbumAudienceInput9.bind(this));};l.prototype.$PhotoAlbumAudienceInput9=function(m,n){'use strict';var o=this.$PhotoAlbumAudienceInput8.getTokens().length>0;this.$PhotoAlbumAudienceInput10(o);};l.prototype.$PhotoAlbumAudienceInput10=function(m){'use strict';i.conditionShow(this.$PhotoAlbumAudienceInput2,m);i.conditionShow(this.$PhotoAlbumAudienceInput1,!m);this.$PhotoAlbumAudienceInput5&&i.conditionShow(this.$PhotoAlbumAudienceInput5,m);};f.exports=l;},null);
__d('PhotoAlbumPlacesTypeahead',['Arbiter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';if(!j)return;if(j.getCore().getHiddenValue()){var k={uid:j.getCore().getHiddenValue(),text:j.getCore().getValue()};h.inform('PhotoAlbumPlacesTypeahead.EXIST_PLACE',k);}j.subscribe('select',(function(l,m){h.inform('PhotoAlbumPlacesTypeahead.SELECTED_PLACE',m.selected);}).bind(this));j.subscribe('reset',(function(){if(!j.getCore().getHiddenValue())h.inform('PhotoAlbumPlacesTypeahead.RESET_PLACE');}).bind(this));j.subscribe('focus',(function(){h.inform('PhotoAlbumPlacesTypeahead.FOCUSED');}).bind(this));this._initialized=true;}i.prototype.init=function(j){'use strict';if(this._initialized)return;i.call(this,j);};f.exports=i;},null);
__d('PersistentAlbumDataStore',['WebStorage'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='fb_album_recovery',j=7*60*60*24,k={_storageExists:true,_initializeWebStorage:function(){var l=h.getLocalStorage();if(!l){k._storageExists=false;return;}if(!l.getItem(i))l.setItem(i,JSON.stringify({}));},_getAlbumsObject:function(){if(!k._storageExists)return {};k._initializeWebStorage();return JSON.parse(h.getLocalStorage().getItem(i));},_setAlbumsObject:function(l){if(!k._storageExists)return;k._initializeWebStorage();h.getLocalStorage().setItem(i,JSON.stringify(l));},_getLocalStorageByAlbum:function(l){return (k._getAlbumsObject()[l]||k.createAlbum(l));},_setLocalStorageByAlbum:function(l,m){var n=k._getAlbumsObject();n[l]=m;k._setAlbumsObject(n);},createAlbum:function(l){var m={privacy:null,tags:{},created_at:Date.now()};k._setLocalStorageByAlbum(l,m);return m;},deleteAlbum:function(l){var m=k._getAlbumsObject();delete m[l];k._setAlbumsObject(m);},getAlbumPrivacy:function(l){return k._getLocalStorageByAlbum(l).privacy;},setAlbumPrivacy:function(l,m){var n=k._getLocalStorageByAlbum(l);n.privacy=m;k._setLocalStorageByAlbum(l,n);},saveTag:function(l,m,n){var o=k._getLocalStorageByAlbum(l);if(!o.tags[m])o.tags[m]=[];n.recovered=true;o.tags[m].push(n);k._setLocalStorageByAlbum(l,o);},removeTag:function(l,m,n){var o=k._getLocalStorageByAlbum(l),p=o.tags[m]||[];for(var q=0;q<p.length;q++)if(p[q].subject===n||p[q].name===n){p.splice(q,1);break;}o.tags[m]=p;k._setLocalStorageByAlbum(l,o);},getTags:function(l,m){return (k._getLocalStorageByAlbum(l).tags[m]||[]);},deleteExpiredAlbums:function(){var l=k._getAlbumsObject();for(var m in l){var n=l[m];if(Date.now()-n.created_at>j*1000)k.deleteAlbum(m);}}};f.exports=k;},null);
__d('PhotoBulkEditTagger',['Arbiter','AsyncRequest','CSS','DOM','DOMQuery','Event','FaceboxSourceConstants','Parent','PersistentAlbumDataStore','PhotosConst','PhotosTaggingWaterfall','PhotoTagger','PhotoTagStore','SubscriptionsHandler','Vector','$','csx','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z,aa,ba=60;z=babelHelpers.inherits(ca,s);aa=z&&z.prototype;function ca(da,ea,fa,ga){'use strict';aa.constructor.call(this,da);this.editor=da;this.faceboxes=[];this.gkEnableTagNext=ga.gkEnableTagNext;this._qn=ga.qn;this.tokenizer=fa;this.editor.registerTagger(this);this.typeahead=fa.getTypeahead();this.handlers=new u();this.root=this.editor.getRoot();this.tagger=ea;this.hideNewTagTimer=null;this.photoKey=null;this._needTaggingData=true;this._currentRecognition={box:null,isTagged:false,suggestion:null};this._hoverState=false;this._tagging=false;this.setupHandlers();this._sendWaterfallLogSignal(r.BEGIN);this.fetchTaggingSuggestions();this.setTagAccumulator(ga.bulkSaveTags);this.setNeedTaggingData(ga.needTaggingData);this.version=q.BULK_EDITOR;m.listen(this.root,'mousemove',(function(event){var ha=event.getTarget();if(this._hoverState&&!(o.byClass(ha,'faceBox')||o.byClass(ha,'tagPointer')||o.byClass(ha,'arrow')||o.byClass(ha,'faceboxSuggestion'))){this.removeSuggestionFromTagger();this.hideTagger();}}).bind(this));}ca.prototype.setupUserActionLogging=function(){'use strict';return null;};ca.prototype.logUserActionEvent=function(da){'use strict';return null;};ca.prototype.addFaceboxes=function(da){'use strict';this.faceboxes=l.scry(da.parentNode,'.faceBox');this.faceboxes.sort(function(ha,ia){return ha.offsetLeft===ia.offsetLeft?ha.offsetTop-ia.offsetTop:ha.offsetLeft-ia.offsetLeft;});var ea=o.byClass(da,'editablePhoto'),fa=t.getInstance().getPhotoTags(ea.getAttribute('data-photoid')),ga=[];Object.keys(fa).forEach(function(ha){if(fa[ha].fbid)ga[fa[ha].fbid]=true;});this.faceboxes.forEach((function(ha){var ia=this.getFaceboxSuggestionFromFaceboxElem(ha),ja=ha.getAttribute('data-faceboxid');if(ia&&fa[ia.getAttribute('data-id')]||ga[ja]){k.remove(ha);return;}var ka={image:da,facebox:ha};m.listen(ha,'mouseenter',this._mouseOverFacebox.bind(this,ka));}).bind(this));};ca.prototype.saveTag=function(da,ea,fa){'use strict';if(!ea.info.recovered){aa.saveTag.call(this,da,ea,fa);var ga=this.getTaggingDataForSave(ea,fa);p.saveTag(this.photoData.albumFBID,this.photoData.fbid,ga);}h.inform('PhotoBulkEditTagger.TAG_SAVED',{editor:this.root,fbid:this.photoData.fbid});};ca.prototype.recoverPhoto=function(da){'use strict';this.setupPhotoDataForTarget(da.getRoot());var ea=p.getTags(this.photoData.albumFBID,this.photoData.fbid);ea.forEach((function(fa){var ga=this.tokenizer.createToken({uid:fa.subject?fa.subject:fa.name,text:fa.name,suggestion:fa.from_facebox,freeform:fa.subject==='',recovered:true});this.tokenizer.addToken(ga);t.getInstance().storeTagWithOptions(this.photoData.fbid,fa.subject,fa.x,fa.y,fa);}).bind(this));};ca.prototype.setNeedTaggingData=function(da){'use strict';this._needTaggingData=da;return this;};ca.prototype.setTagAccumulator=function(da){'use strict';aa.setTagAccumulator.call(this,da);return this;};ca.prototype.needTaggingData=function(){'use strict';return this._needTaggingData;};ca.prototype.setupHandlers=function(){'use strict';m.listen(this.root,'click',this.clickHandler.bind(this));this.tokenizer.subscribe(['addToken','removeToken'],this.handleTokenAction.bind(this));this.tokenizer.subscribe('switchTarget',this.switchPhoto.bind(this));this.tokenizer.subscribe('initialized',this.editor._recoverPhotos.bind(this.editor));h.subscribe('PhotoBulkEditTagger.DATA_SOURCE_READY',this.useTaggingDataSource.bind(this));h.subscribe(this.editor.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'),this.hideTagger.bind(this));};ca.prototype.hideTagger=function(){'use strict';aa.hideTagger.apply(this,arguments);if(this._currentRecognition.box&&!this._currentRecognition.isTagged)j.show(this._currentRecognition.box);this._tagging=false;this._hoverState=false;this._currentRecognition.box=null;this._currentRecognition.isTagged=false;this._currentRecognition.suggestion=null;this.recognizedUsers=[];};ca.prototype.done=function(){'use strict';this._sendWaterfallLogSignal(r.FINISH);};ca.prototype.handleTokenAction=function(da,ea){'use strict';var fa=w(this.photoKey),ga=k.find(fa,'.peopleIcon'),ha=k.find(fa,'.editablePhotoTagList'),ia=k.find(ga,'.count'),ja=this.tokenizer.getTokens().length,ka=ea.info.suggestion?n.UPLOADER_SUGGEST:null;if(this._currentRecognition.box)this._currentRecognition.isTagged=!!ja;j.conditionClass(ga,'hasPeople',!!ja);j.conditionClass(ha,'hasPeople',!!ja);k.setContent(ia,ja);if(da=='addToken'){this.saveTag(da,ea,ka);if(!this.gkEnableTagNext)return;for(var la=0;la<this.faceboxes.length;la++)if(j.shown(this.faceboxes[la])){setTimeout((function(){this.showTaggerByFacebox(this.faceboxes[la]);}).bind(this),100);break;}}else{this.removeTag(da,ea);p.removeTag(this.photoData.albumFBID,this.photoData.fbid,ea.info.uid);h.inform('PhotoBulkEditTagger.TAG_REMOVED',{editor:this.root,fbid:this.photoData.fbid});}};ca.prototype.useTaggingDataSource=function(da,ea){'use strict';if(!this._needTaggingData)return;var fa=this.tokenizer.getTypeahead();fa.swapData(ea);this.setNeedTaggingData(false);};ca.prototype.getTaggerPositioningOrigin=function(){'use strict';return v.getElementPosition(this.root);};ca.prototype.showTaggerByFacebox=function(da){'use strict';var ea=o.byClass(da,'faceBox');if(!ea)ea=o.byClass(da,'recognitionBox');this._currentRecognition.box=ea;var fa=o.byClass(da,'editablePhotoImage');this.setupPhotoDataForTarget(fa);var ga=k.find(fa,'.scaledImage img'),ha=null,ia=null,ja=null,ka=this.getRecognitionBoxCenter(ea,ga);ha=ka.boxPos;ia=ka.boxDim;ja=ka.taggerPos;j.hide(this._currentRecognition.box);this.recognizedUsers=JSON.parse(ea.getAttribute('data-recognizeduids'));this.setUpTagger(ga,fa,ha,ia,ja);};ca.prototype.getRecognitionBoxCenter=function(da,ea){'use strict';var fa=v.getElementPosition(da).add(v.getElementDimensions(da).mul(.5)),ga=v.getElementDimensions(this._currentRecognition.box),ha=this.calcTaggerPosition(ea,fa,ga.x,ga.y);return {boxPos:fa,boxDim:ga,taggerPos:ha};};ca.prototype.setUpTagger=function(da,ea,fa,ga,ha){'use strict';this.calcClickPoint(da,fa);ha.setElementPosition(this.tagger);if(ga)ga.setElementDimensions(this.tagger);j.hide(k.find(ea,'.clickToTagMessage'));this._sendWaterfallLogSignal(r.TAG_FACE);this.updateTypeaheadSuggestions();this.updateWithSuggestions();this.showTagger();this._tagging=true;};ca.prototype.clickHandler=function(event){'use strict';var da=event.getTarget();if(o.byClass(da,'photoTagTypeahead'))return;if(this._hoverState){this._hoverState=false;this._tagging=true;return;}if(this.tagger){this.hideTagger();this.removeSuggestionFromTagger();this.handlers.release();}if(o.byClass(da,'photoContextualSelector')||o.byClass(da,'removePhotoButton'))return;var ea=o.byClass(da,'editablePhotoImage');if(!ea){var fa=o.byClass(da,'peopleIcon');if(fa)this.setupPhotoDataForTarget(fa);return;}this.setupPhotoDataForTarget(ea);var ga=k.find(ea,'.scaledImage img'),ha=null,ia=null,ja=null,ka=o.byClass(da,'faceBox');if(!ka)ka=o.byClass(da,'recognitionBox');this._currentRecognition.box=ka;if(this._currentRecognition.box&&j.shown(this._currentRecognition.box)){var la=this.getRecognitionBoxCenter(ka,ga);ha=la.boxPos;ia=la.boxDim;ja=la.taggerPos;j.hide(this._currentRecognition.box);this._currentRecognition.isTagged=false;var ma=this.getFaceboxSuggestionFromFaceboxElem(ka);if(ma){this._currentRecognition.suggestion=ma;this.addSuggestionToTagger(ka,ma);this._sendFaceboxSuggestionLogSignal(ma.getAttribute('data-id'),n.UPLOADER_SUGGEST);}else this.recognizedUsers=JSON.parse(ka.getAttribute('data-recognizeduids'));}if(ja===null){ha=v.getEventPosition(event);ja=this.calcTaggerPosition(ga,ha,ba);}if(!ja)return;this.setUpTagger(ga,ea,ha,ia,ja);};ca.prototype._mouseOverFacebox=function(da){'use strict';if(this._tagging)return;var ea=da.image,fa=da.facebox,ga=this.getFaceboxSuggestionFromFaceboxElem(fa);if(ga){this._hoverState=true;this._currentRecognition.box=fa;this._currentRecognition.suggestion=ga;this.setupPhotoDataForTarget(ea);this.addSuggestionToTagger(fa,ga);this._sendFaceboxSuggestionLogSignal(ga.getAttribute('data-id'),n.UPLOADER_SUGGEST);this._sendWaterfallLogSignal(r.HOVER_TAG_FACE);var ha=v.getElementPosition(fa).add(v.getElementDimensions(fa).mul(.5)),ia=v.getElementDimensions(this._currentRecognition.box),ja=this.calcTaggerPosition(ea,ha,ia.x,ia.y);this.calcClickPoint(ea,ha);ja.setElementPosition(this.tagger);ia.setElementDimensions(this.tagger);this.showTagger();}};ca.prototype.fetchTaggingSuggestions=function(){'use strict';this.logUserActionEvent('sugg_fetch');new i().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption('retries',1).setHandler((function(da){var ea=da.getPayload();this.featuredSuggestions=ea.featuredTaggees;this.friendSuggestions=ea.friendTaggees;this.logUserActionEvent('sugg_fetch_done');}).bind(this)).send();};ca.prototype.switchPhoto=function(da,ea){'use strict';var fa=y(ea);fa&&this.setupPhotoDataForTarget(fa);this.hideTagger();};ca.prototype.getImageByID=function(da){'use strict';return y('editablePhoto_'+da);};ca.prototype.setupPhotoDataForTarget=function(da){'use strict';var ea;if(da&&!j.hasClass(da,'editablePhoto')){ea=o.byClass(da,'editablePhoto');}else ea=da;if(!ea){this.photoKey=null;this.photoData=null;return false;}var fa=ea.id;if(fa===this.photoKey)return;this.photoKey=fa;this.photoData=this.editor.getPhotoData(fa);this.tokenizer.setTokenarea(k.find(ea,'div.editablePhotoTagList'));};ca.prototype.getPosition=function(){'use strict';return this.photoData.fbid;};ca.prototype.tagsChangeHandler=function(da){'use strict';};ca.prototype.removeTagByID=function(da,ea,fa){'use strict';this.hideTagger();this.setupPhotoDataForTarget(this.getImageByID(da));aa.removeTagByID.call(this,da,ea,fa);};ca.prototype.setupFaceboxSuggestionHandlers=function(da,ea){'use strict';var fa=k.find(ea,"._570w"),ga=k.find(ea,"._570x");this.handlers.engage();this.handlers.addSubscriptions(m.listen(fa,'click',(function(ha){this.dismissFaceboxSuggestion(da.id.replace('face:',''),ea.getAttribute('data-id'),this.photoData.owner,n.UPLOADER_DISMISS);this.removeSuggestionFromTagger();this.hideTagger();k.remove(this.getFaceboxSuggestionFromFaceboxElem(da));}).bind(this)),m.listen(ga,'click',(function(ha){var ia=this.tokenizer.createToken({uid:ea.getAttribute('data-id'),text:ea.getAttribute('data-text'),suggestion:true});this.removeSuggestionFromTagger();j.hide(da);this.tokenizer.addToken(ia);}).bind(this)));};Object.assign(ca.prototype,{elemNames:{}});f.exports=ca;},null);
__d('PhotoBulkEditTokenizer',['DOM','Event','Input','Parent','Tokenizer','UserAgent_DEPRECATED','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;o=babelHelpers.inherits(q,l);p=o&&o.prototype;q.prototype.init=function(r,s,t,u){'use strict';this._tokenareaListeners={};p.init.call(this,r,s,t,u);this.inform('initialized');};q.prototype.initEvents=function(){'use strict';var r=m.firefox()<4?'keypress':'keydown';i.listen(this.input,'paste',this.paste.bind(this));i.listen(this.input,r,this.keydown.bind(this));};q.prototype.setTokenarea=function(r){'use strict';this.tokenarea=r;this.addTokenareaListener(r);this.reset();};q.prototype.addTokenareaListener=function(r){'use strict';if(this._tokenareaListeners[r.id])return;var s=this.handleEvents.bind(this);this._tokenareaListeners[r.id]=n(i.listen(r,{click:s,keydown:s}));};q.prototype.handleEvents=function(event){'use strict';var r=k.byClass(event.getTarget(),'editablePhotoTagList');if(!r){return;}else if(this.tokenarea!==r){this.setTokenarea(r);this.inform('switchTarget',this.tokenarea.id);}return p.handleEvents.call(this,event);};q.prototype.reset=function(){'use strict';var r=this.getTokenElements().map(function(s){return {uid:h.scry(s,'input')[0].value,text:h.scry(s,'input')[1].value};});j.reset(this.input);return p.reset.call(this,r);};q.prototype.updateTokenareaVisibility=function(){'use strict';return null;};q.prototype.insertToken=function(r){'use strict';h.prependContent(this.tokenarea,r.getElement());};function q(){'use strict';o.apply(this,arguments);}f.exports=q;},null);
__d('ProgressiveDatepicker',['Arbiter','ArbiterMixin','CSS','DataStore','DOM','Event','Parent','getElementText','mixin','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s;function t(w){return new Date(w[0],w[1],w[2],w[3],w[4]);}function u(w,x){while(w.length)l.insertAfter(x,w.pop());}r=babelHelpers.inherits(v,p(i));s=r&&r.prototype;function v(w,x){'use strict';s.constructor.call(this);this._root=w;this._savedLabels={};this._savedPeriodsBack=[];this._savedPeriodsFront=[];this._menus={};this._dayOrderAscending=x.dayorderascending;var y=0;if(x.gmtoffset!==undefined)y=-new Date().getTimezoneOffset()-x.gmtoffset;this._mintime=x.mintime&&new Date(1000*x.mintime-y*60000);this._maxtime=x.maxtime&&new Date(1000*x.maxtime-y*60000);k.set(w,'datepicker',this);l.scry(w,'select').forEach((function(z){m.listen(z,'change',q(this._handleChange,this,z));var aa=n.byClass(z,'period');m.listen(z,'focus',j.addClass.bind(null,aa,'periodFocus'));m.listen(z,'blur',j.removeClass.bind(null,aa,'periodFocus'));this._setMenuSelectionState(z);if(z.getAttribute('data-name')==='month')this._filterInvalidDates();}).bind(this));l.scry(w,'a.periodLabel').forEach(function(z){var aa=n.byClass(z,'period');m.listen(z,'click',function(){j.addClass(aa,'periodSelected');j.addClass(aa,'periodFocus');});});this._filterInvalidDates();this.inform('initialized',this,h.BEHAVIOR_STATE);}v.prototype.setDate=function(w,x,y,z,aa){'use strict';this._addSavedPeriods();var ba=v.PERIODS;for(var ca=0;ca<ba.length;ca++)this._setValueForPeriod(ba[ca],arguments[ca]);this._filterInvalidDates();this.inform('changed');};v.prototype.setDateWithTimestamp=function(w){'use strict';var x=new Date(w);this.setDate(x.getFullYear(),x.getMonth()+1,x.getDate(),x.getHours(),x.getMinutes());};v.prototype.isSet=function(){'use strict';var w=v.PERIODS;for(var x=0;x<w.length;x++)if(this._getValueForPeriod(w[x]))return true;return false;};v.prototype.getRoot=function(){'use strict';return this._root;};v.prototype.getValues=function(){'use strict';var w=v.PERIODS,x={};for(var y=0;y<w.length;y++){var z=this._getValueForPeriod(w[y]);if(z)x[w[y]]=z;}return x;};v.prototype.getDate=function(){'use strict';var w=this.getValues();return new Date(w.year||0,(w.month||1)-1,w.day||1,w.hour||0,w.minute||0);};v.prototype.getTimestamp=function(){'use strict';return Math.round(this.getDate().getTime()/1000);};v.prototype._setValueForPeriod=function(w,x){'use strict';var y=this._menuForPeriodName(w);if(!y)return;if(x===undefined)x='';var z=y.options;for(var aa=0,ba=z.length;aa<ba;aa++)if(z[aa].value==x){y.selectedIndex=aa;break;}this._setMenuSelectionState(y);};v.prototype._getValueForPeriod=function(w){'use strict';var x=this._menuForPeriodName(w);return x&&x.options[x.selectedIndex].value;};v.prototype._handleChange=function(w){'use strict';this._setMenuSelectionState(w);this._filterInvalidDates();this.inform('changed');};v.prototype._setMenuSelectionState=function(w){'use strict';var x=n.byClass(w,'period');if(!x)return;if(j.hasClass(x,'periodRequired')){if(w.selectedIndex===0)w.selectedIndex=1;}else this._updateLabel(w);var y=w.getAttribute('data-name'),z=w.options[w.selectedIndex].value;j.conditionClass(x,'periodSelected',z);j.conditionClass(this._root,this._selectedClass(y),z);if(!z)this._resetMenu(v.PERIODS.indexOf(y)+1);};v.prototype._updateLabel=function(w){'use strict';var x=w.getAttribute('data-name'),y=w.options[0];if(!this._savedLabels[x])this._savedLabels[x]=o(y);if(w.selectedIndex===0){l.setContent(y,this._savedLabels[x]);}else l.setContent(y,'--');};v.prototype._daysInMonth=function(w,x){'use strict';return new Date(w||1999,x+1||1,0).getDate();};v.prototype._daysInCurrentMonth=function(){'use strict';return this._daysInMonth(this._getValueForPeriod('year'),this._getValueForPeriod('month')-1);};v.prototype._menuForPeriodName=function(w){'use strict';if(!this._menus[w])this._menus[w]=l.scry(this._root,'.'+w+'Menu')[0];return this._menus[w];};v.prototype._selectedClass=function(w){'use strict';return 'uiProgressiveDatepickerSelected-'+w;};v.prototype._resetMenu=function(w){'use strict';var x=v.PERIODS;for(;w<x.length;w++){var y=x[w],z=this._menuForPeriodName(y);if(!z)return;if(n.byClass(z,'periodRequired')){z.selectedIndex=1;}else{j.removeClass(n.byClass(z,'period'),'periodSelected');j.removeClass(this._root,this._selectedClass(y));z.selectedIndex=0;this._updateLabel(z);}}};v.prototype._addSavedPeriods=function(){'use strict';var w=v.PERIODS;for(var x=0;x<w.length;x++){var y=this._menuForPeriodName(w[x]);if(!y)return;this._savedPeriodsFront[x]||(this._savedPeriodsFront[x]=[]);this._savedPeriodsBack[x]||(this._savedPeriodsBack[x]=[]);var z=y.options[0],aa=y.options[y.options.length-1];if(x===v.PERIODS.indexOf('hour')||x===v.PERIODS.indexOf('minute')||x===v.PERIODS.indexOf('day')&&this._dayOrderAscending){u(this._savedPeriodsFront[x],z);u(this._savedPeriodsBack[x],aa);}else{u(this._savedPeriodsBack[x],z);u(this._savedPeriodsFront[x],aa);}}};v.prototype._filterInvalidDates=function(){'use strict';this._addSavedPeriods();var w=v.PERIODS,x=this.getValues();for(var y=0;y<w.length;y++){var z=this._menuForPeriodName(w[y]);if(!z)return;this._savedPeriodsFront[y]||(this._savedPeriodsFront[y]=[]);this._savedPeriodsBack[y]||(this._savedPeriodsBack[y]=[]);for(var aa=1;aa<z.options.length;){var ba=z.options[aa],ca=[y-1>=0?x[w[0]]:0,y-1>=1?x[w[1]]-1:0,y-1>=2?x[w[2]]:1,y-1>=3?x[w[3]]:0,y-1>=4?x[w[4]]:0];ca[y]=ba.value;if(y===v.PERIODS.indexOf('month'))ca[y]=ca[y]-1;var da=t(ca),ea=[y-1>=0?x[w[0]]:9001,y-1>=1?x[w[1]]-1:11,y-1>=2?x[w[2]]:this._daysInCurrentMonth(),y-1>=3?x[w[3]]:23,y-1>=4?x[w[4]]:59];ea[y]=ba.value;if(y===v.PERIODS.indexOf('month')){ea[y]--;ea[y+1]=this._daysInMonth(ea[0],ea[1]);}var fa=t(ea),ga=da>this._maxtime,ha=fa<this._mintime,ia=y===v.PERIODS.indexOf('day')&&ba.value>this._daysInCurrentMonth();if(ha||ga||ia){if(ba.selected){ba.selected=false;this._resetMenu(y);}l.remove(ba);if(ga||ia){this._savedPeriodsBack[y].push(ba);}else this._savedPeriodsFront[y].push(ba);}else aa++;}}};v.getInstance=function(w){'use strict';return w?k.get(w,'datepicker'):null;};Object.assign(v,{PERIODS:['year','month','day','hour','minute']});f.exports=v;},null);
__d('PhotosBulkEditablePhoto',['Arbiter','AsyncDialog','AsyncRequest','AsyncResponse','CSS','Dialog','DOM','Event','Focus','Form','Input','Parent','PhotosConst','PlaceUtils','ProgressiveDatepicker','csx','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z=null,aa=null,ba=false;function ca(da,ea,fa,ga,ha,ia,ja){'use strict';this._root=da;this._mentionsTypeahead=ea;this._placesTypeahead=fa;this._photoData=ga;this._hasOwnPlaceValue=!!fa.getCore().getHiddenValue();var ka=n.find(da,'.placesInput'),la=n.find(da,'.captionTextarea'),ma=n.find(fa.element,'.uiTypeaheadCloseButton');this._metadataInputs=n.find(da,'.metadataInputs');this._editorId=ha;this._published=ia;this._showMove=ja;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated;this._listeners=[o.listen(da,'click',this._handleClick.bind(this)),o.listen(ka,'focus',this._placesFocus.bind(this)),o.listen(la,'focus',this._captionFocus.bind(this)),o.listen(la,'blur',this._save.bind(this)),o.listen(ma,'click',(function(){setTimeout(this._save.bind(this),0);}).bind(this)),o.listen(da,'submit',function(){return false;})];this._previousSaveData=q.serialize(this._root);var na=n.scry(this._root,'div.backdateInput .periodMenu');for(var oa=0;oa<na.length;oa++){var pa=na[oa];this._listeners.push(o.listen(pa,'change',(function(){return this._saveDate();}).bind(this)));}var qa=n.scry(this._root,"._2sfm").pop();if(qa){var ra=qa.getAttribute('data-direction');this._listeners.push(o.listen(qa,'click',this._rotate.bind(this,ra)));}var sa=n.scry(da,'.photoContextualSelector')[0];if(sa){var ta=n.scry(sa,'.moveAlbum')[0];ta&&this._listeners.push(o.listen(ta,'click',this._move.bind(this)));var ua=n.scry(sa,'.albumCover')[0];ua&&this._listeners.push(o.listen(ua,'click',this._setAlbumCover.bind(this)));var va=n.scry(sa,'.removePhoto')[0];va&&this._listeners.push(o.listen(va,'click',this.remove.bind(this)));}else{var wa=n.find(da,'.removePhotoButton');this._listeners.push(o.listen(wa,'click',this.remove.bind(this)));}this._placesDataListener=[fa.subscribe(['select','reset','render'],(function(xa,ya){l.conditionClass(this._root,'focusedInput',xa=='render');if(xa=='render')return;if(xa=='reset'&&fa.getCore().getHiddenValue())return;if(ya&&ya.selected){z=ya.selected;if(aa==z.text){ba=true;}else{aa=z.text;ba=false;}}else{z=null;aa=null;ba=false;}this._hasOwnPlaceValue=xa=='select';l.conditionClass(n.find(da,'.placeIcon'),'hasPlace',this._hasOwnPlaceValue);if(this._hasOwnPlaceValue)this._save();}).bind(this))];this._placesInputBlurListener=fa.getCore().subscribe('blur',(function(xa,ya){l.removeClass(this._root,'focusedInput');}).bind(this));h.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this,h.BEHAVIOR_PERSISTENT);}ca.prototype.getPhotoDataKey=function(){'use strict';return this._photoDataKey;};ca.prototype.getPhotoData=function(){'use strict';return this._photoData;};ca.prototype.getRoot=function(){'use strict';return this._root;};ca.prototype.getDragHandle=function(){'use strict';return this.getRoot();};ca.prototype.getRotateButtonType=function(){'use strict';return this._rotateButtonType;};ca.prototype.swapData=function(da,ea){'use strict';var fa=this._mentionsTypeahead.getData(),ga=this._placesTypeahead.getData();if(fa!==da)this._mentionsTypeahead.swapData(da);if(ga!==ea){var ha=this._placesTypeahead.getCore().getValue(),ia=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(ea);if(this.hasOwnPlaceValue())this._placesTypeahead.getCore().select({text:ha,uid:ia});}};ca.prototype.hasOwnPlaceValue=function(){'use strict';return this._hasOwnPlaceValue;};ca.prototype.setAlbumPlace=function(da,ea){'use strict';this._hasOwnPlaceValue=false;var fa=this._placesTypeahead.getCore();l.conditionClass(n.find(this._root,'.placeIcon'),'hasPlace',!!da);if(da){fa.select(da);}else fa.reset();if(!ea)this._save();};ca.prototype.addPlaceSelectHandler=function(da){'use strict';this._placesDataListener.push(this._placesTypeahead.subscribe('select',da));};ca.prototype.mapEventNameToNamespace=function(da){'use strict';return da+(this._editorId?'/'+this._editorId:'');};ca.prototype.setDate=function(da,ea){'use strict';if(this._hasExistingDateValue)return;var fa=!da,ga=da;if(fa){if(!this._hasTimeTaken)return;ga=Math.round(this._photoData.timeTaken/600)*600*1000;}var ha=n.find(this.getRoot(),'.uiProgressiveDatepicker'),ia=v.getInstance(ha);ia.setDateWithTimestamp(ga);l.conditionClass(n.find(this._root,'.dateIcon'),'hasDate',!!ga);if(fa)this._saveDate(ea);};ca.prototype._doRemove=function(){'use strict';n.remove(this._root);this._unsubscribeAll();h.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this);};ca.prototype._unsubscribeAll=function(){'use strict';this._listeners.forEach(function(da){da.remove();});this._listeners=[];this._placesDataListener.forEach((function(da){this._placesTypeahead.unsubscribe(da);}).bind(this));this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener);};ca.prototype._handleClick=function(da){'use strict';var ea=da.getTarget();if(s.byClass(ea,'confirmPhotoBackdate')){this._saveDate();return;}if(!s.byClass(ea,'metaIcon'))return;l.addClass(this._root,'showControls');if(s.byClass(ea,'placeIcon')){this._showMetadataInput('place');p.set(this._placesTypeahead.getCore().getElement());}else if(s.byClass(ea,'dateIcon')){this._showMetadataInput('date');}else if(s.byClass(ea,'peopleIcon')){h.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.TAG_BUTTON_CLICKED'),this);this._showMetadataInput('people');}else l.removeClass(this._root,'showControls');};ca.prototype.hideMetadataInputs=function(){'use strict';this._showMetadataInput();};ca.prototype._showMetadataInput=function(da){'use strict';['people','date','place'].forEach((function(ea){l.conditionClass(this._metadataInputs,ea,da==ea);}).bind(this));};ca.prototype._captionFocus=function(da){'use strict';this.hideMetadataInputs();l.addClass(this._root,'focusedInput');};ca.prototype.remove=function(){'use strict';var da={fbid:this._photoData.fbid,version:t.BULK_EDITOR,confirmed:true};new m().setTitle(y._("Delete Photo")).setBody(y._("Are you sure you want to delete this photo?")).setButtons(m.OK_AND_CANCEL).setModal(true).setHandler((function(){l.addClass(this._root,'editablePhotoWillBeRemoved');new j().setURI('/ajax/photos/photo/delete/dialog.php').setData(da).setHandler((function(ea){if(ea.getPayload().success){this._doRemove();}else l.removeClass(this._root,'editablePhotoWillBeRemoved');}).bind(this)).setErrorHandler((function(ea){l.removeClass(this._root,'editablePhotoWillBeRemoved');k.defaultErrorHandler(ea);}).bind(this)).send();}).bind(this)).show();};ca.prototype._setAlbumCover=function(){'use strict';var da={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},ea=new j().setURI('/ajax/photos/album/setcover/').setData(da).setAllowCrossPageTransition(false);i.send(ea);};ca.prototype._move=function(){'use strict';var da={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},ea=new j().setURI('/ajax/photos/photo/move/dialog.php').setData(da).setAllowCrossPageTransition(false);i.send(ea);};ca.prototype._timeclose=function(da,ea){'use strict';da=da||0;ea=ea||0;return Math.abs(da-ea)<43200;};ca.prototype._placesFocus=function(da){'use strict';l.addClass(this._root,'focusedInput');var ea=n.scry(this._root,'input.latitude')[0],fa=n.scry(this._root,'input.longitude')[0],ga=n.scry(this._root,'input.takentime')[0],ha=ga?r.getValue(ga):null,ia=this._placesTypeahead.getData(),ja=ia.getBootstrapData(),ka={};if(ea&&fa){ka={latitude:r.getValue(ea),longitude:r.getValue(fa),proximity_boost:'true',city_id:null,search_time:ha};ia.setQueryData(ka,false);if(!u.placesClose(ja.latitude,ja.longitude,ka.latitude,ka.longitude)||!this._timeclose(ja.search_time,ka.search_time))ia.setBootstrapData(ka,false).setBootstrapEndpoint(ia.getQueryEndpoint());}else{ka={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:ha};if(z)if(z.city_id){ka.city_id=z.city_id;}else if(z.latitude&&z.longitude){ka.latitude=z.latitude;ka.longitude=z.longitude;}ia.setQueryData(ka,false);if(!ba){ia.setBootstrapData(ka).resetBootstrapEndpoint(true);}else if(!u.placesClose(ja.latitude,ja.longitude,ka.latitude,ka.longitude)||!this._timeclose(ja.search_time,ka.search_time))ia.setBootstrapData(ka,false).resetBootstrapEndpoint();}};ca.prototype._saveDate=function(da){'use strict';var ea=n.find(this._root,'div.backdateInput'),fa=q.serialize(ea);fa.source=this.source;fa.fbid=this._photoData.fbid;fa.version=t.BULK_EDITOR;fa.bulk=!!da;l.addClass(ea,'backdating');new j().setURI('/ajax/photos/photo/backdate/').setData(fa).setRelativeTo(this._root).send();};ca.prototype._save=function(){'use strict';l.removeClass(this._root,'focusedInput');var da=q.serialize(this._root);if(this._previousSaveData){var ea=false;for(var fa in da){if(fa!=='caption'&&fa!=='location'&&fa!=='location_data')continue;if(da[fa]!==this._previousSaveData[fa]){ea=true;this._previousSaveData[fa]=da[fa];}}if(!ea)return;}da.source=this.source;da.bulk=!this._hasOwnPlaceValue;new j().setURI('/ajax/photos/metadata/save/').setData(da).setAllowCrossPageTransition(true).send();};ca.prototype._setLoadingIndicator=function(da){'use strict';l.conditionClass(this._root,"_2sfl",da);};ca.prototype._rotate=function(da){'use strict';var ea={fbid:this._photoData.fbid,cs_ver:t.BULK_EDITOR,editor_id:this._editorId,published:this._published,showMove:this._showMove};ea[da]=1;this._setLoadingIndicator(true);new j('/ajax/photos/photo/rotate/').setData(ea).setHandler((function(fa){n.replace(this._root,fa.getPayload());this._unsubscribeAll();h.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED'),this);}).bind(this)).setFinallyHandler((function(){this._setLoadingIndicator(false);}).bind(this)).setMethod('POST').send();return false;};f.exports=ca;},null);
__d('PhotosBulkEditablePhotoPlaceholder',['CSS','DOM','Event','csx','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();function m(n,o,p){'use strict';this._root=n;this._progressBar=o;this._uploadID=p;this._initAndGetGatedButton("._3273",'cancelButtonClicked');this._retryButton=this._initAndGetGatedButton("._3p03",'retryButtonClicked');this._errorOkayButton=this._initAndGetGatedButton("._8qx",'dismissPlaceholder');this._errorCloseButton=this._initAndGetGatedButton("._8qy",'dismissPlaceholder');}m.prototype._initAndGetGatedButton=function(n,o){'use strict';var p=i.scry(this._root,n);if(p.length){p=p[0];j.listen(p,'click',(function(){return this.emit(o,this._uploadID);}).bind(this));return p;}};m.prototype.getProgressBar=function(){'use strict';return this._progressBar;};m.prototype.getRoot=function(){'use strict';return this._root;};m.prototype.hide=function(){'use strict';h.hide(this._root);};m.prototype.show=function(){'use strict';h.show(this._root);};m.prototype.showRetryButton=function(){'use strict';this._retryButton&&h.show(this._retryButton);};m.prototype.showErrorOkayButton=function(){'use strict';this._errorOkayButton&&h.show(this._errorOkayButton);};m.prototype.showErrorCloseButton=function(){'use strict';this._errorCloseButton&&h.show(this._errorCloseButton);};l(m,{cancelButtonClicked:true,retryButtonClicked:true,dismissPlaceholder:true});f.exports=m;},null);
__d("XPhotoBatchEditLocationController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/edit\/batch\/location\/",{});},null);
__d('PhotosBulkEditor',['ActorURI','Arbiter','AsyncRequest','Button','CSS','DOM','Event','PageTransitions','Parent','PhotosConst','SortableGroup','xuiglyph','XPhotoBatchEditLocationController','mapObject','createIxElement','cx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y={ASCENDING:'ascending',DESCENDING:'descending',MANUAL:'manual'},z={ascending:s({name:'triangle-up',shade:'dark',size:'small'}),descending:s({name:'triangle-down',shade:'dark',size:'small'})};function aa(ba,ca,da,ea,fa,ga,ha,ia,ja){'use strict';this.source=ba;if(!ca)return;this._root=ca;this._reorderButton=m.scry(this._root.parentNode,'button.reorderButton').pop();this._id=ca.getAttribute('id');this._ownerID=ja;this._photos={};this._tagger=null;this._options=ha;this._isNamespaced=ia;this._placeholder=fa;this._waitingTemplate=ga;this._mentionsData=da;this._placesData=ea;this._albumPlace=null;this._userDate=null;this._useDateFromFile=false;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=this.source===q.FLASH_UPLOADER;this._coverPhotoSortingID=null;if(ha.canReorder)this._initSorting(ha.autosaveReorder);var ka=[i.subscribe(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this._registerPhoto.bind(this)),i.subscribe([this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED')],(function(la,ma){if(this._sortableGroup){var na=ma.getPhotoData().fbid;this._sortableGroup.removeSortable(na);}delete this._photos[ma.getPhotoDataKey()];}).bind(this)),i.subscribe('PhotosBulkEditor.AUTO_ORDER',this._autoOrder.bind(this)),i.subscribe('PhotosBulkBackdateEditor.SAVED',(function(la,ma){this._useDateFromFile=ma.useDateFromFile;this._userDate=ma.backdatedDate;this._setDate();}).bind(this)),i.subscribe(['PhotoAlbumPlacesTypeahead.SELECTED_PLACE','PhotoAlbumPlacesTypeahead.EXIST_PLACE','PhotoAlbumPlacesTypeahead.RESET_PLACE'],this._setPlace.bind(this)),i.subscribe('PhotosBulkEditablePhoto.MOVED',(function(la,ma){if(this.getPhotoData(ma))this._photos[ma]._doRemove();}).bind(this))];n.listen(this._root,'click',(function(la){var ma=p.byClass(la.getTarget(),'editablePhoto'),na=this._photos;m.scry(this._root,'.showControls').forEach(function(oa){if(ma!==oa){l.removeClass(oa,'showControls');na[oa.id].hideMetadataInputs();}});}).bind(this));o.registerHandler((function(){ka.forEach(function(la){la.unsubscribe();});if(this._tagger)this._tagger.done();}).bind(this));}aa.prototype.init=function(ba,ca,da,ea,fa,ga){'use strict';aa.call(this,this.source,ba,ca,da,ea,fa,ga);};aa.prototype.getRoot=function(){'use strict';return this._root;};aa.prototype.getSourceString=function(){'use strict';if(this.source===q.BULK_EDITOR){return 'bulk_editor';}else if(this.source===q.FLASH_UPLOADER){return 'flash_uploader';}else return null;};aa.prototype.isNamespaced=function(){'use strict';return this._isNamespaced;};aa.prototype.getVersionConst=function(){'use strict';return this.source;};aa.prototype.getViewerSource=function(){'use strict';return null;};aa.prototype.getViewerSet=function(){'use strict';return null;};aa.prototype.registerTagger=function(ba){'use strict';this._tagger=ba;};aa.prototype.needTaggingData=function(){'use strict';return this._tagger&&this._tagger.needTaggingData();};aa.prototype.getPhotoData=function(ba){'use strict';var ca=this._photos[ba];if(ca)return ca.getPhotoData();return {};};aa.prototype.getPlaceholder=function(){'use strict';return this._placeholder;};aa.prototype.getWaitingTemplate=function(){'use strict';return this._waitingTemplate;};aa.prototype.addFaceboxes=function(ba){'use strict';this._tagger&&this._tagger.addFaceboxes(ba);};aa.prototype.mapEventNameToNamespace=function(ba){'use strict';return ba+(this._isNamespaced?'/'+this._id:'');};aa.prototype._registerPhoto=function(event,ba){'use strict';this._setSortMode(y.MANUAL);this._photos[ba.getPhotoDataKey()]=ba;ba.source=this.source;var ca=ba.getPhotoData(),da=ca.fbid;if(this._sortableGroup)this._sortableGroup.addSortable(da,ba.getRoot(),ba.getDragHandle());ba.swapData(this._mentionsData,this._placesData);if(this._sortableGroup)ba.addPlaceSelectHandler((function(){this._sortableGroup.killDrag(da);}).bind(this));if(this._albumPlace&&!ba.hasOwnPlaceValue())ba.setAlbumPlace(this._albumPlace);if(this._sortableGroup&&this._albumCoverTracksFirstPhoto)this._coverPhotoSortingID=this._sortableGroup.getOrder()[0];};aa.prototype._recoverPhotos=function(ba){'use strict';var ca=this._photos;for(var da in ca){var ea=ca[da];this._tagger.recoverPhoto(ea);l.addClass(ea.getRoot(),'showRecognitionBoxes');var fa=m.find(ea.getRoot(),'div.uiScaledImageContainer.scaledImage');this.addFaceboxes(fa);}};aa.prototype._initSorting=function(ba){'use strict';this._setSortMode(y.MANUAL);this._dropCallback=(function(ca,da,ea){var fa=this._photos[da.id].getPhotoData(),ga={order:this._sortableGroup.getOrder(),owner:fa.owner};if(ba){var ha;if(fa.set){ga.set=fa.set;ha='/ajax/photos/sets/static/reorder.php';}else{ga.album_fbid=fa.albumFBID;ha='/ajax/photos/reorder.php';}new j(ha).setData(ga).send();}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==ga.order[0]){var ia=this._photos[this._sortableGroup.sortables[ga.order[0]].id];if(ia)this._makeAlbumCover(ia);this._coverPhotoSortingID=ga.order[0];}if(!ea)this._setSortMode(y.MANUAL);}).bind(this);this._sortableGroup=new r().setDropCallback(this._dropCallback).setBeforeGrabCallback((function(){i.inform(this.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'));}).bind(this));};aa.prototype._compare=function(ba,ca){'use strict';switch(this._sortMode){case y.MANUAL:return this._orderLookup[ba.fbid]<this._orderLookup[ca.fbid];case y.ASCENDING:return ba.timeTaken<ca.timeTaken;case y.DESCENDING:return ba.timeTaken>ca.timeTaken;default:throw new Error('Invalid sort mode');}};aa.prototype._setSortMode=function(ba){'use strict';if(!this._reorderButton)return;this._sortMode=ba;var ca=null,da=ba!==y.MANUAL;if(da){ca=v(z[ba]);l.addClass(ca,"_3-8_");}k.setDepressed(this._reorderButton,da);k.setIcon(this._reorderButton,ca);};aa.prototype._autoOrder=function(){'use strict';switch(this._sortMode){case y.MANUAL:var ba,ca,da=this.getOrder();this._orderLookup={};for(ca=0;ca<da.length;ca++){ba=da[ca];this._orderLookup[ba]=ca;}this._setSortMode(y.ASCENDING);break;case y.ASCENDING:this._setSortMode(y.DESCENDING);break;case y.DESCENDING:this._setSortMode(y.MANUAL);break;default:throw new Error('Invalid sort mode');}var ea=this._sortableGroup.getOrder().map((function(ma){return this._photos['editablePhoto_'+ma].getPhotoData();}).bind(this));this._sortableGroup.setDropCallback(x);var fa,ga,ha;for(fa=0;fa<ea.length;fa++){ga=fa;for(ha=fa+1;ha<ea.length;ha++)if(this._compare(ea[ha],ea[ga]))ga=ha;if(fa!==ga){var ia=ea[ga].fbid,ja=ea[fa].fbid;this._sortableGroup.dragOverHandler(ja,ia);this._sortableGroup.dropHandler(ia);ea.splice(fa,0,ea.splice(ga,1)[0]);}}var ka=Object.keys(this._photos)[0],la=this._photos[ka];this._dropCallback(la.getPhotoData().fbid,la.getRoot(),true);this._sortableGroup.setDropCallback(this._dropCallback);};aa.prototype._saveCurrentOrder=function(){'use strict';if(this._photos.length===0)return;var ba=this._sortableGroup.getOrder()[0],ca=this._photos['editablePhoto_'+ba]||this._photos['photoContainer_'+ba];if(!ca)return;var da=ca.getPhotoData();if(!da.albumFBID)return;var ea={order:this._sortableGroup.getOrder(),owner:da.owner,album_fbid:da.albumFBID};new j('/ajax/photos/reorder.php').setData(ea).send();};aa.prototype._setPlace=function(event,ba){'use strict';this._albumPlace=ba||null;var ca=this._options.batchUpdateLocation,da=[];u(this._photos,function(fa,ga){if(fa.hasOwnPlaceValue())return;fa.setAlbumPlace(this._albumPlace,ca);if(ca)da.push(fa.getPhotoData().fbid);},this);if(ca){var ea=t.getURIBuilder().getURI();if(this._ownerID)ea=h.create(ea,this._ownerID);new j(ea).setData({photo_ids:da,location:this._albumPlace?this._albumPlace.text:'',location_data:this._albumPlace?this._albumPlace.uid:0}).send();}};aa.prototype._setDate=function(){'use strict';var ba='',ca=null,da;for(var ea in this._photos){da=this._photos[ea];if(!this._useDateFromFile){ba=this._userDate.month+'/'+this._userDate.day+'/'+this._userDate.year;ca=new Date(ba).getTime();}da.setDate(ca,true);}};aa.prototype._showAlbumCoverSet=function(ba){'use strict';if(this._albumCover)l.removeClass(this._albumCover,"checked");var ca=m.find(ba.getRoot(),'.albumCover');l.addClass(ca,"checked");this._albumCover=ca;};aa.prototype._makeAlbumCover=function(ba){'use strict';new j().setURI('/ajax/photos/album/setcover').setData(ba.getPhotoData()).send();};aa.prototype.getOrder=function(){'use strict';if(this._sortableGroup){return this._sortableGroup.getOrder();}else return [];};aa.prototype.hasOrder=function(){'use strict';return !!this._sortableGroup;};f.exports=aa;},null);
__d('PhotosBulkHeader',['Arbiter','AsyncRequest','DOM','Event','Form','Run','areJSONRepresentationsEqual','goURI','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();function q(r,s,t,u){'use strict';this._form=r;this._isAlbum=s;this._editable=t;this._audience=u;this._backdatedTime=null;this._initialData=null;h.subscribe('PhotosBulkBackdateEditor.SAVED',(function(v,w){if(!j.contains(this._form.getRoot(),w.context))return;this._backdatedTime=w.backdatedDate;}).bind(this));m.onBeforeUnload((function(){if(this.isDataDirty())return p._("Some of your changes have not been saved. Would you like to save your changes now?");return false;}).bind(this));this._initialData=this.getSerializedData();}q.prototype.getSerializedData=function(){'use strict';var r=l.serialize(this._form.getRoot());if(this._backdatedTime)r.backTime=this._backdatedTime;return r;};q.prototype.isDataDirty=function(){'use strict';return !n(this._initialData,this.getSerializedData());};q.prototype.save=function(r){'use strict';if(!this._editable)return r.call();if(this._audience&&this._audience.removeHiddenPrivacyWidget)this._audience.removeHiddenPrivacyWidget();var s=this._isAlbum?'/ajax/photos/album/edit':'/ajax/photos/sets/edit',t=l.serialize(this._form.getRoot());if(this._backdatedTime)t.backdated_time=this._backdatedTime;new i(s).setData(t).setMethod('POST').setHandler((function(){this._initialData=this.getSerializedData();r();}).bind(this)).send();};q.doneButtonSaveHandler=function(r,s,t){'use strict';var u=r.save.bind(r,function(){o(s);return true;});r._listeners=[k.listen(t,'click',u)];};f.exports=q;},null);
__d('PlacesTypeaheadBehavior',['CSS','DOM'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={init:function(k,l){k.subscribe(['reset','select','highlight'],function(m,n){if(m==='highlight'&&n.index!==-1&&n.selected.type!='freeform'&&n.selected.map&&!n.selected.changeCity){i.setContent(l,n.selected.map);h.show(l);}else h.hide(l);});}};f.exports=j;},null);
__d('legacy:ShowResultsOnFocusTypeaheadBehavior',['TypeaheadShowResultsOnFocus'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.showResultsOnFocus=function(i){i.enableBehavior(h);};},3);